<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SKY LAND - DAFTAR AKUN</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial,sans-serif;background:radial-gradient(circle at top,#7b2cbf,#4c0f8c);color:#fff}
.container{min-height:100vh;display:flex;flex-direction:column;justify-content:center;padding:20px;max-width:420px;margin:auto}
.logo-box{display:flex;justify-content:center;margin-bottom:14px}
.logo{width:110px;height:110px;border-radius:50%;padding:6px;background:linear-gradient(45deg,#22c55e,#a855f7,#22c55e);animation:glow 4s infinite}
.logo img{width:100%;height:100%;border-radius:50%}
@keyframes glow{0%{box-shadow:0 0 10px #22c55e}50%{box-shadow:0 0 30px #a855f7}100%{box-shadow:0 0 10px #22c55e}}
h1{text-align:center;font-size:18px;margin:6px 0}
p{text-align:center;font-size:13px;opacity:.9;margin-bottom:20px}
input{width:100%;padding:14px;margin-bottom:10px;border:none;border-radius:14px;font-size:14px}
button{width:100%;padding:14px;border:none;border-radius:14px;font-size:14px;margin-top:8px}
.daftar{background:linear-gradient(135deg,#22c55e,#16a34a);color:#000;font-weight:bold}
.back{background:#dc2626;color:#fff}
.msg{text-align:center;margin-top:10px;font-size:13px}
.success{color:#22c55e;font-weight:bold}
.error{color:#fecaca}
</style>
</head>
<body>

<div class="container">
<div class="logo-box"><div class="logo"><img src="https://files.catbox.moe/hz53ab.jpg"></div></div>
<h1>SILAKAN BUAT AKUN ANDA</h1>
<p>Masukan data dengan benar</p>

<input type="text" id="username" placeholder="Masukan Username">
<input type="password" id="password" placeholder="Masukan Password">
<input type="text" id="invite" placeholder="Masukan Kode Invite (WAJIB)">

<button class="daftar" onclick="daftar()">DAFTAR</button>
<button class="back" onclick="location.href='login.html'">KEMBALI KE LOGIN</button>
<div class="msg" id="msg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// ðŸ”¹ Firebase Config Realtime DB
const firebaseConfig = {
  apiKey: "AIzaSyCkWKmK_UmQtk6UEIset5e6iPmFZj0ZLHc",
  authDomain: "bugemtoolsdb.firebaseapp.com",
  databaseURL: "https://bugemtoolsdb-default-rtdb.firebaseio.com",
  projectId: "bugemtoolsdb",
  storageBucket: "bugemtoolsdb.firebasestorage.app",
  messagingSenderId: "52270788635",
  appId: "1:52270788635:web:59bf1c23406beb872e48be",
  measurementId: "G-SHMYMXM4Z4"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.daftar = async ()=>{
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  const i = document.getElementById("invite").value.trim();
  const msg = document.getElementById("msg");

  if(!u || !p || !i){
    msg.className="msg error";
    msg.innerText="Semua field wajib diisi";
    return;
  }

  try{
    // ===== Cek Kode Invite =====
    const inviteRef = ref(db,"invites/"+i);
    const inviteSnap = await get(inviteRef);
    if(!inviteSnap.exists()){
      msg.className="msg error";
      msg.innerText="Kode invite tidak valid";
      return;
    }

    // ===== Cek Username =====
    const userRef = ref(db,"users/"+u);
    const userSnap = await get(userRef);
    if(userSnap.exists()){
      msg.className="msg error";
      msg.innerText="Username sudah terdaftar";
      return;
    }

    // ===== Buat User Baru =====
    await set(userRef,{password: p, coin: 0});

    // ===== Hapus Kode Invite =====
    await remove(inviteRef);

    msg.className="msg success";
    msg.innerText="âœ… DAFTAR BERHASIL, SILAKAN LOGIN";

  } catch(e){
    msg.className="msg error";
    msg.innerText="Gagal daftar, coba lagi";
    console.error("Daftar error:", e);
  }
}
</script>
</body>
</html>